
### å·¥ä½œå†…å®¹ç®€ä»‹

æœ¬æ¬¡å°å­¦æœŸæˆ‘ä¸»è¦è´Ÿè´£çš„éƒ¨åˆ†æ˜¯è¿›è¡Œwebæ¼æ´é¢˜ç›®è®¾è®¡ï¼Œä¸»è¦å·¥ä½œå†…å®¹æ¶‰åŠäº†ç¬¬ä¸€é¢˜è·å¾—ç™»é™†å¯†ç ä»¥åŠç¬¬äºŒé¢˜xssçš„é¢˜ç›®è®¾ç½®ï¼ŒåŒ…æ‹¬builditï¼Œbreakitä»¥åŠfixitã€‚æ¶‰åŠè¿™éƒ¨åˆ†çš„ä»£ç æ–‡ä»¶ç”±æ±ªç¿åŒå­¦ä¸€èµ·æäº¤ã€‚

åœ¨ä¸ºæœŸ20å¤©çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä¸ä»…å­¦ä¹ äº†æ›´å¤šæ¼æ´ç±»å‹ï¼Œæ›´åŠ æ·±å…¥åœ°äº†è§£äº†è·¨ç«™è„šæœ¬æ¼æ´ï¼Œæ³¨å…¥æ¼æ´ï¼Œæš´åŠ›ç ´è§£ï¼Œcsrfæ”»å‡»ç­‰ç­‰ã€‚ä¹Ÿåˆ©ç”¨openwrtæºç ï¼Œä¿®æ”¹å†…å®¹å°è¯•è‡ªå·±ç¼–è¯‘ä¸ªæ€§åŒ–çš„å›ºä»¶ï¼Œå­¦ä¹ äº†luaè¯­è¨€ï¼Œåœ¨åæœŸçš„webæ¼æ´é¢˜å‹çš„è®¾è®¡ä¸­ä¿®æ”¹ä»£ç ï¼Œè®¾è®¡é¢˜ç›®ç­‰æ–¹é¢èµ·åˆ°äº†é‡è¦çš„ä½œç”¨ã€‚

åœ¨ç¼–è¯‘å®Œæˆä¹‹åè™šæ‹Ÿæœºå°è¯•ä½¿ç”¨vscodeè¿œç¨‹è¿æ¥ï¼Œä½†å‡ºç°äº†`Could not establish connection to "192.168.23.130". bash not found`çš„é—®é¢˜ï¼Œç”±æ–¼å®‰è£…å®Œä¹‹åæç¤ºæ¶æ„ä¸å¯¹ï¼Œæœ€ç»ˆçš„å¼€å‘ä½¿ç”¨äº†ftpè¿™ä¸ªè¿œç¨‹ç¼–å†™å·¥å…·ã€‚è¿™ä¹Ÿç®—ä¸€ä¸ªè®©æˆ‘å°è±¡æ·±åˆ»çš„â€œæ”¹å˜â€ã€‚

æ€»ä½“æ¥è¯´ï¼Œæœ¬æ¬¡å°å­¦æœŸæˆ‘çš„å·¥ä½œå†…å®¹ä¸å¤šï¼Œä½†æ˜¯è¿‡ç¨‹ä¸­æ¯å¤©éƒ½åœ¨è·Ÿç€å°ç»„ä¸€èµ·å­¦ä¹ ä¸åŒçš„çŸ¥è¯†ï¼Œå®ƒä»¬æœ‰çš„è¢«åº”ç”¨åœ¨äº†æœ€ç»ˆæˆæœä¸­ï¼Œè€Œæœ‰çš„å¯¹æˆ‘æœªæ¥çš„å­¦ä¹ æˆ–è®¸æ˜¯ä¸€ç§ç§¯ç´¯ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œç»„å‘˜ä»¬éƒ½ç§¯æäº¤æµï¼Œäº’ç›¸ç£ä¿ƒäº’ç›¸è¯·æ•™ï¼ŒåŸºæœ¬æ¯ä¸¤ä¸‰å¤©å°±ä¼šå¼€ä¸€æ¬¡ç»„ä¼šäº¤æµå·¥ä½œè¿›åº¦ï¼Œåˆ†äº«é‡åˆ°çš„é—®é¢˜ï¼Œå…±åŒè§£å†³ï¼Œè¿™ä¹Ÿè®©æˆ‘ä½“ä¼šåˆ°äº†å›¢é˜Ÿçš„æ„ä¹‰ã€‚

#### webæ¼æ´è®¾è®¡

**è·å¾—ç™»å½•å¯†ç **

* æ•´ä½“è®¾è®¡ä»¥åŠè§£é¢˜æ€è·¯

    * ç”¨æˆ·è®¿é—®å›ºä»¶ç™»é™†ç•Œé¢ï¼Œå¯†ç æœªçŸ¥ã€‚é€šè¿‡è¾“å…¥ä»»æ„å€¼ï¼Œåˆ©ç”¨burpsuiteæˆªè·æŠ¥æ–‡ï¼Œå¯åœ¨è¯·æ±‚å¤´ä¸­å¾—åˆ°ä¸€ä¸²æç¤ºï¼ˆå‰ç¼€cucç»è¿‡md5åŠ å¯†ï¼‰ï¼š`totallengthis6,f1f4e30acef64bd0d346b050e73289e7`ï¼Œæ”»å‡»è€…åç»­é€šè¿‡å¯¹`f1f4e30acef64bd0d346b050e73289e7`è¿›è¡ŒMD5è§£å¯†å¾—åˆ°å‰ç¼€`cuc`ï¼Œç”±æç¤ºå¯çŸ¥æ˜¯å…­ä½å¯†ç ï¼Œéšåå¯¹åä¸‰ä½åˆ©ç”¨å¯†ç æœ¬è¿›è¡Œçˆ†ç ´ï¼Œè·å¾—æœ€ç»ˆå¯†ç `cuc123`ï¼ŒæˆåŠŸç™»å½•è·¯ç”±å™¨åå°ã€‚æˆåŠŸç™»é™†åæˆªè·çš„æŠ¥æ–‡ä¸­å‡ºç°flagã€‚

* `vim /usr/lib/lua/luci/dispatcher.lua`æ‰¾åˆ°ä»¥ä¸‹ä½ç½®ä¿®æ”¹,åœ¨æŠ¥æ–‡è¯·æ±‚å¤´ä¸­æ·»åŠ æç¤ºï¼š

```lua
if not sid then
				local tmpl = require "luci.template"

				context.path = {}

				http.status(403, "Forbidden")
                --luci.http.header("Hint", "total length is 6,f1f4e30acef64bd0d346b050e73289e7")
				tmpl.render(track.sysauth_template or "sysauth", {
					duser = default_user,
					fuser = user
				})

				return
			end

			http.header("Set-Cookie", 'sysauth=%s; path=%s; HttpOnly%s' %{
				sid, build_url(), http.getenv("HTTPS") == "on" and "; secure" or ""
			})
            --luci.http.header("Congradulations:", "flag{123}")
			http.redirect(build_url(unpack(ctx.requestpath)))
		end

		if not sid or not sdat then
			http.status(403, "Forbidden")
            --luci.http.header("Hint", "total length is 6,f1f4e30acef64bd0d346b050e73289e7")
			return
		end

		ctx.authsession = sid
		ctx.authtoken = sdat.token
		ctx.authuser = sdat.username
	end

```

**xss**

* æ•´ä½“è®¾è®¡æ€è·¯

    * æ”»å‡»è€…åœ¨æˆåŠŸç™»é™†ä¹‹åéœ€è¦æ‰¾åˆ°xssæ”»å‡»ç‚¹ï¼Œç»•è¿‡æˆ‘ä»¬è®¾ç½®çš„é™åˆ¶ï¼Œ(é€šè¿‡è¿‡æ»¤å°–æ‹¬å·)ï¼Œæ‰èƒ½è·å¾—æç¤ºä¿¡æ¯ã€‚åŒæ—¶è®¾è®¡äº†base32ç¼–ç ç­‰â€œåˆ«å‡ºå¿ƒè£â€çš„ï¼Œä¸åŒäºç›´æ¥è¿›è¡Œbase64ç¼–ç çš„æ–¹å¼â€œä¸ºéš¾â€æ”»å‡»è€…ã€‚åœ¨è®¾è®¡æ—¶ï¼Œä¸ºäº†é˜²æ­¢æ”»å‡»è€…ç›´æ¥æŸ¥çœ‹æºç å¾—åˆ°æç¤ºä¿¡æ¯ï¼Œæˆ‘ä»¬å°†æç¤ºä¿¡æ¯å†™å…¥äº†ä¸€ä¸ªjsæ–‡ä»¶(showMessage.js)ï¼Œä»¥è·å¾—ä¸‹ä¸€é¢˜â€œå‘½ä»¤æ³¨å…¥â€çš„ç›¸å…³æç¤ºã€‚

    * åˆ©ç”¨å¯¼èˆªæ `firewall port-forward` çš„ `name` å­—æ®µæ„é€  xssï¼Œå°†ç­”æ¡ˆæ”¾åœ¨`showMessage.js`çš„å‡½æ•°é‡Œï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ä¼šå¼¹çª—ç»™å‡ºæç¤ºä¿¡æ¯

    * ç¼–å†™jsæ–‡ä»¶å¹¶å°†å…¶æ”¾åœ¨ `luci-static/resources`ç›®å½•ä¸‹ï¼Œå¹¶åœ¨`nsection.htm`ä¸­åŠ å…¥`<script src="/luci-static/resources/showM.js"></script>`ï¼›ç”¨æˆ·æ ¹æ®è—åœ¨ç•Œé¢æºç çš„æç¤ºçŸ¥é“éœ€è¦è§¦å‘ showMessageå‡½æ•°ã€‚

* éš¾ç‚¹

    * è¿‡æ»¤å­—æ®µï¼Œåœ¨`forward-details.lua`,å¯¹`<xx>`è¿‡æ»¤

```lua
Â  Â  Â  Â  function escape(input)
Â  Â  Â  Â  Â  Â  local stripTagsRE = "</?[^>]+>"
Â  Â  Â  Â  Â  Â  local filteredInput = string.gsub(input, stripTagsRE, "")
Â  Â  Â  Â  Â  Â  return filteredInput Â  Â 
Â  Â  Â  Â  end
```

* è§£å†³æ–¹æ³•

    * è¾“å…¥`<svg onload=showMessage()//`å¯ä»¥ç»•è¿‡

#### é¢˜ç›®ä¸€ æ€è·¯

* ç”¨æˆ·ç™»å½•éœ€è¦è¾“å…¥å¯†ç ï¼Œä¾æ®è¿™ä¸€å¿…è¦æ¡ä»¶è®¾è®¡é¢˜ç›®ã€‚

* ç”±äºå¯†ç æœªçŸ¥ï¼Œç›®çš„æ˜¯å¸Œæœ›ç”¨æˆ·é€šè¿‡éšæ„è¾“å…¥å¯†ç æäº¤ï¼ŒåŒæ—¶åå°è¿›è¡ŒæŠ“åŒ…ï¼Œç”¨æˆ·ä»æŠ¥æ–‡ä¸­è·å¾—æç¤ºï¼Œä¾æ®æç¤ºè§£é¢˜ã€‚

#### é¢˜ç›®ä¸€ è§£é¢˜è¿‡ç¨‹(å…·ä½“è§[Login](https://github.com/zhouyuting-mafumafu/DVRF/tree/record/Login))

* éšæ„è¾“å…¥å¯†ç ï¼ŒburpsuiteæŠ“åŒ…è·å¾—æç¤º

* ç¡®å®šå¯†ç æ˜¯å…­ä½ï¼Œè·å¾—ä¸€ä¸²å¯†æ–‡ï¼ŒçŒœæµ‹MD5åŠ å¯†ï¼Œè¿›è¡Œè§£å¯†ï¼š

* çŒœæµ‹å¯†ç `cuc345`ï¼Œå†æ¬¡æŠ“åŒ…ï¼Œå°†æˆªè·çš„æŠ¥æ–‡å‘é€è‡³intruderï¼Œpayloadé€‰ä¸­`345`ï¼Œè¿›è¡Œçˆ†ç ´ï¼š

* è·å¾—åä¸‰ä½å¯†ç 

* ç™»é™†æˆåŠŸï¼Œæ­¤å¤„å°†ä¼šæç¤ºä¸‹ä¸€é¢˜çš„æ”»å‡»å†…å®¹ï¼š



#### é¢˜ç›®ä¸€ fix it

* é˜²æ­¢å¯†ç è¢«è½»æ˜“çˆ†ç ´ï¼Œå»ºè®®æ˜¯ä½¿ç”¨ä½æ•°æ›´å¤šï¼Œä¸”æ›´åŠ å¤æ‚çš„å¯†ç ï¼Œå¹¶ä¸”ä½¿ç”¨sha256åŠ å¯†ã€‚

#### é¢˜ç›®äºŒ fix it(writeupè§[XSS](https://github.com/zhouyuting-mafumafu/DVRF/tree/record/XSS))

* vim usr/model/cbi/firewall/forward-details.lua
```lua
if not name or #name == 0 then
		name = translate("(Unnamed Entry)")
	end
	--m.title = "%s - %s" %{ translate("Firewall - Port Forwards"), name }
	m.title = "%s - %s" %{ translate("Firewall - Port Forwards"), luci.util.pcdata(name) }
end

s = m:section(NamedSection, arg[1], "redirect", "")
```

* vim usr/model/cbi/firewall/rule-details.lua

```lua
		name = "SNAT %s" % name
	end

	--m.title = "%s - %s" %{ translate("Firewall - Traffic Rules"), name }
	m.title = "%s - %s" %{ translate("Firewall - Traffic Rules"), luci.util.pcdata(name) }

	local wan_zone = nil
```

### å­¦ä¹ ç¬”è®°

#### ç¼–è¯‘OpenWrtå®šåˆ¶å±äºè‡ªå·±çš„å›ºä»¶

* å®éªŒç¯å¢ƒ

    * è™šæ‹Ÿæœºï¼šUbuntu22.04 LTS x64

    * å¤–éƒ¨ç³»ç»Ÿï¼šwin10

* æ³¨æ„äº‹é¡¹

    * ä¸è¦ä½¿ç”¨rootç”¨æˆ·

    * ç¼–è¯‘è¿‡ç¨‹éœ€è¦ç§‘å­¦ä¸Šç½‘


* å‡†å¤‡ç¼–è¯‘ç¯å¢ƒ

```bash
##æ·»åŠ ç”¨æˆ·
adduser openwrt
usermod -a -G sudo openwrt
su openwrt
##æ›´æ–°ç»„ä»¶
sudo apt update
##ä¸‹è½½å®‰è£…ç¼–è¯‘ç¯å¢ƒ
sudo apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 python2.7 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler g++-multilib antlr3 gperf wget curl swig rsync
```

å›æ˜¾å‡ºç°`this may take some timeâ€¦done`å°±æ˜¯ä¸‹è½½æˆåŠŸäº†ã€‚

* æ‹‰å–å¹¶ä¿®æ”¹openwrtæºç 

å¯ä»¥æŸ¥çœ‹iotgoatçš„networké‡Œé¢commitçš„è®°å½•ï¼Œå­¦ä¹ ä¿®æ”¹

```bash
##iotgoatæºç 
https://github.com/OWASP/IoTGoat/network
##å…³é”®æ–‡ä»¶è·¯å¾„
OpenWrt/openwrt-18.06.2/files/usr/lib/lua/luci
```

forkæºç è‡³æœ¬åœ°ä»“åº“ï¼Œåœ¨filesæ–‡ä»¶å¤¹å†…æ·»åŠ è‡ªå·±ç¼–å†™çš„luaå’Œhtmï¼Œå®šåˆ¶ä¸ªæ€§åŒ–ç³»ç»Ÿã€‚

```bash
##lede æºç åœ°å€
https://github.com/coolsnowwolf/lede
## æºä»£ç ä»“åº“åœ¨Githubä¸Šçš„ä¸€ä¸ªé•œåƒ
https://github.com/openwrt/openwrt
```


* æ›´æ–°ä¸‹è½½feeds

è¿›å…¥ `feeds.conf.default`

æ·»åŠ æ’ä»¶åœ°å€ï¼š

```bash
src-git kenzok https://github.com/kenzok8/openwrt-packages
src-git small https://github.com/kenzok8/small
```

éšåç»ˆç«¯è¿›å…¥æºç ç›®å½•(cd ledeæˆ–cd openwrt)ï¼Œè¾“å…¥ï¼š

```bash
./scripts/feeds update -a ï¼ˆæ›´æ–°feedsæºï¼‰
./scripts/feeds install -a ï¼ˆå®‰è£…feedsæºï¼‰
```

* é…ç½®æ–‡ä»¶

ç¬¬ä¸€ç§æ˜¯åœ¨æºç ä¸­æ·»åŠ ç•Œé¢æ–¹å¼ï¼Œå¦‚ä¸Šæ–‡æ‹‰å–ä¿®æ”¹openwrtæºç ã€‚
ç¬¬äºŒç§æ˜¯æ­¤å¤„åœ¨å¼€å‘æ¿ç³»ç»Ÿä¸­æ·»åŠ ç•Œé¢æ–¹å¼ã€‚åœ¨ç³»ç»Ÿæ¿ä¸Šä¿®æ”¹ç•Œé¢é…ç½®æ–‡ä»¶åï¼Œå¯ä»¥é©¬ä¸Šåœ¨ç½‘é¡µç«¯çœ‹åˆ°ä¿®æ”¹æ•ˆæœï¼Œä¸ç”¨é‡æ–°ç¼–è¯‘Openwrtæºç å’Œçƒ§å†™å›ºä»¶ï¼Œä¼˜ç‚¹ï¼šå¼€å‘ä¾¿æ·ï¼Œç¼ºç‚¹ï¼šé‡åˆ·ç³»ç»Ÿåç›¸å…³æ–‡ä»¶ä¿®æ”¹ä¿¡æ¯ä¸¢å¤±ã€‚

å¦‚æœé€‰æ‹©ç¬¬äºŒç§æ–¹å¼ å»ºè®®æ˜¯menuconfigçš„é»˜è®¤é…ç½®é€šè¿‡ç¬¬ä¸€æ¬¡ç¼–è¯‘ä¹‹åå†è‡ªå®šä¹‰ï¼Œè¿™æ ·ç¼–è¯‘æˆåŠŸç‡ä¼šæ›´é«˜ã€‚å¦‚æœä¸æ‰“ç®—è°ƒæ•´ç»„ä»¶åˆ™è¾“å…¥`make defconfig`ï¼Œå®ƒä¼šæ£€æµ‹ç¼–è¯‘ç¯å¢ƒå¹¶ç”Ÿæˆé»˜è®¤çš„ç¼–è¯‘é…ç½®æ–‡ä»¶ã€‚éœ€è¦é…ç½®åˆ™è¾“å…¥`make menuconfig`

å›¾å½¢é…ç½®ç•Œé¢:
```bash
OpenWrt Configurationã€OpenWrté…ç½®ã€‘

Target System (x86) â€”> ç›®æ ‡ç³»ç»Ÿï¼ˆx86ï¼‰

Subtarget (x86_64) â€”> å­ç›®æ ‡ï¼ˆx86_64ï¼‰

Target Profile (Generic) â€”>ç›®æ ‡é…ç½®æ–‡ä»¶ï¼ˆé€šç”¨ï¼‰

Target Images â€”> ä¿å­˜ç›®æ ‡é•œåƒçš„æ ¼å¼

Enable experimental features by default â€”> é»˜è®¤æƒ…å†µä¸‹å¯ç”¨å®éªŒåŠŸèƒ½

Global build settings â€”> å…¨å±€æ„å»ºè®¾ç½®

Advanced configuration options (for developers) ---- é«˜çº§é…ç½®é€‰é¡¹ï¼ˆé€‚ç”¨äºå¼€å‘äººå‘˜ï¼‰

Build the OpenWrt Image Builder æ„å»ºOpenWrtå›¾åƒç”Ÿæˆå™¨

Build the OpenWrt SDKæ„å»ºOpenWrt SDK

Package the OpenWrt-based Toolchainæ‰“åŒ…åŸºäºOpenWrtçš„å·¥å…·é“¾

Image configuration â€”>å›¾åƒé…ç½®

Base system â€”> åŸºæœ¬ç³»ç»Ÿ

Administration â€”> ç®¡ç†

Boot Loaders â€”>å¼•å¯¼åŠ è½½ç¨‹åº

Development â€”> å¼€å‘

Extra packages â€”> é¢å¤–åŒ…

Firmware â€”>å›ºä»¶

Fonts â€”>å­—ä½“

Kernel modules â€”> å†…æ ¸æ¨¡å—

Languages â€”>è¯­è¨€

Libraries â€”> å›¾ä¹¦é¦†

LuCI â€”> LuCI è½¯ä»¶åŒ…

Mail â€”>é‚®ä»¶

Multimedia â€”>å¤šåª’ä½“

Network â€”>ç½‘ç»œ

Sound â€”> å£°éŸ³

Utilities â€”>å®ç”¨ç¨‹åº

Xorg â€”>Xorg
```
å»ºè®®é€‰é¡¹ï¼Œè§†è‡ªèº«æƒ…å†µè€Œå®šï¼š
```bash
1.é€‰æ‹©CPUå‹å·
Target Systemâ€”â€“Atheros AR71xx/AR7240/AR913x/AR934x

2.é€‰æ‹©è·¯ç”±å‹å·
Target Profileâ€”-TP-LINK TL-MR3420 v1

3.æ·»åŠ luci
 LuCIâ€”>Collectionsâ€”â€“ <*> luci

4.æ·»åŠ luciçš„ä¸­æ–‡è¯­è¨€åŒ…
LuCIâ€”>Translationsâ€”- <*> luci-i18n-chinese

5.æ·»åŠ DDNS
LuCIâ€”>Applications â€”> <*>luci-app-ddns.

6.æ·»åŠ USBæŒ‚è½½
Base system â€”> <*>block-mount

7.æ·»åŠ ç¡¬ç›˜æ ¼å¼æ”¯æŒ
Kernel modules â€”> Filesystems â€”> <*> kmod-fs-ext4

8.æ·»åŠ UTF8ç¼–ç 
Kernel modules â€”> Native Language Support â€”> <*> kmod-nls-utf8

9.æ·»åŠ USBæ‰©å±•æ”¯æŒ
Kernel modules â€”> USB Support â€”> <*> kmod-usb-storage-extras.

110.æ·»åŠ è‡ªåŠ¨æŒ‚è½½å·¥å…·
Utilities â€”> Filesystem â€”> <*> badblocks

11.æ·»åŠ å¤ä½é”®æ”¯æŒ
Utilities â€”> <*> restorefactory

12.æ·»åŠ ä¸€é”®å¼€å…³æ— çº¿
Utilities â€”> <*> wifitoggle

 æœ€ç®€å•çš„ï¼Œåªéœ€è¦é€‰æ­£é¢ä¸¤é¡¹ï¼Œå…¶ä½™é»˜è®¤å³å¯ï¼š 
1ã€ Target Systemâ€”â€“é€‰æ‹©ç¼–è¯‘ç±»å‹
2ã€ Target Profileâ€”-é€‰æ‹©ç¼–è¯‘è·¯ç”±å‹å·
```

* ä¸‹è½½dlåº“

```bash
make -j8 download V=s
##find dl -size -1024c -exec ls -l {} æ­¤å‘½ä»¤å¯ä»¥åˆ—å‡ºä¸‹è½½ä¸å®Œæ•´çš„æ–‡ä»¶ï¼ˆå°äº1kçš„æ–‡ä»¶å±äºä¸‹è½½ä¸å®Œæ•´ï¼‰,å¦‚æœå­˜åœ¨è¿™æ ·çš„æ–‡ä»¶å¯ä»¥ä½¿ç”¨find dl -size -1024c -exec rm -f {} ;å‘½ä»¤å°†å®ƒä»¬åˆ é™¤ï¼Œç„¶åé‡æ–°æ‰§è¡Œmake downloadä¸‹è½½å¹¶åå¤æ£€æŸ¥
```

* å¼€å§‹ç¼–è¯‘

```bash
make V=s -j1
##ç¬¬ä¸€æ¬¡ç¼–è¯‘æ¨èç”¨å•çº¿ç¨‹ä»¥åå¯ä»¥ä½¿ç”¨make -j$(($(nproc) + 1)) V=s
```
ç¼–è¯‘å®Œæˆåè¾“å‡ºè·¯å¾„(ledeç›®å½•ä¸‹)ï¼š`bin/targets`

* äºŒæ¬¡ç¼–è¯‘
```bash
cd lede   #åˆ‡æ¢åˆ°ledeç›®å½• 
git pull  #æ‹‰å–æœ€æ–°æºç  
./scripts/feeds update -a   #æ›´æ–°è½¯ä»¶æºï¼Œæœ‰ä¸‹è½½ã€‚è‹¥æºç æ²¡æœ‰æ›´æ–°ï¼Œåˆ™æœ¬æ¡åŠä¸‹æ¡å¯ä»¥ä¸æ‰§è¡Œ 
./scripts/feeds install -a  #å®‰è£…è½¯ä»¶æºï¼Œæ— ä¸‹è½½ 
make defconfig
make download -j8
make V=s -j$(nproc)

##é‡æ–°é…ç½®
rm -rf ./tmp && rm -rf .config # æ¸…é™¤ä¸´æ—¶æ–‡ä»¶ åˆ é™¤ç¼–è¯‘é…ç½®æ–‡ä»¶
make menuconfig
make V=s -j$(nproc)
```

#### LUAè¯­æ³•å­¦ä¹ 

* åŒºåˆ†å¤§å°å†™

* Lua äº¤äº’å¼ç¼–ç¨‹æ¨¡å¼å¯ä»¥é€šè¿‡å‘½ä»¤ `lua -i` æˆ– `lua` æ¥å¯ç”¨

* Lua è„šæœ¬å¼ç¼–ç¨‹å°† Lua ç¨‹åºä»£ç ä¿å­˜åˆ°ä¸€ä¸ªä»¥ lua ç»“å°¾çš„æ–‡ä»¶ï¼Œå¦‚`zyt.lua`ï¼Œå¹¶æ‰§è¡Œã€‚ä½¿ç”¨luaåŠ æ–‡æœ¬åæ¥æ‰§è¡Œï¼š`lua zyt.lua`

* **LUAæ•°æ®ç±»å‹**

|æ•°æ®ç±»å‹|æè¿°|
|--|--|
|nil|è¡¨ç¤ºä¸€ä¸ªæ— æ•ˆå€¼ï¼ˆåœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ç›¸å½“äºfalseï¼‰ã€‚|
|boolean|åŒ…å«ä¸¤ä¸ªå€¼ï¼šfalseå’Œtrueã€‚|
|number|è¡¨ç¤ºåŒç²¾åº¦ç±»å‹çš„å®æµ®ç‚¹æ•°|
|string|å­—ç¬¦ä¸²ç”±ä¸€å¯¹åŒå¼•å·æˆ–å•å¼•å·æ¥è¡¨ç¤º|
|function|ç”± C æˆ– Lua ç¼–å†™çš„å‡½æ•°|
|userdata|è¡¨ç¤ºä»»æ„å­˜å‚¨åœ¨å˜é‡ä¸­çš„Cæ•°æ®ç»“æ„|
|thread|è¡¨ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿è·¯ï¼Œç”¨äºæ‰§è¡ŒååŒç¨‹åº|
|table|Lua ä¸­çš„è¡¨ï¼ˆtableï¼‰å…¶å®æ˜¯ä¸€ä¸ª"å…³è”æ•°ç»„"ï¼ˆassociative arraysï¼‰ï¼Œæ•°ç»„çš„ç´¢å¼•å¯ä»¥æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²æˆ–è¡¨ç±»å‹ã€‚åœ¨ Lua é‡Œï¼Œtable çš„åˆ›å»ºæ˜¯é€šè¿‡"æ„é€ è¡¨è¾¾å¼"æ¥å®Œæˆï¼Œæœ€ç®€å•æ„é€ è¡¨è¾¾å¼æ˜¯{}ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºè¡¨ã€‚|

* tipsï¼š

    * boolean ç±»å‹åªæœ‰ä¸¤ä¸ªå¯é€‰å€¼ï¼štrueï¼ˆçœŸï¼‰ å’Œ falseï¼ˆå‡ï¼‰ï¼ŒLua æŠŠ false å’Œ nil çœ‹ä½œæ˜¯ falseï¼Œå…¶ä»–çš„éƒ½ä¸º trueï¼Œæ•°å­— 0 ä¹Ÿæ˜¯ true:

    * å­—ç¬¦ä¸²ç”±ä¸€å¯¹åŒå¼•å·æˆ–å•å¼•å·æ¥è¡¨ç¤ºï¼Œå¯ä»¥ç”¨ 2 ä¸ªæ–¹æ‹¬å· `[[]]` æ¥è¡¨ç¤º"ä¸€å—"å­—ç¬¦ä¸²ã€‚

    * åœ¨ Lua ä¸­ï¼Œå‡½æ•°æ˜¯è¢«çœ‹ä½œæ˜¯"ç¬¬ä¸€ç±»å€¼ï¼ˆFirst-Class Valueï¼‰"ï¼Œå‡½æ•°å¯ä»¥å­˜åœ¨å˜é‡é‡Œ;function å¯ä»¥ä»¥åŒ¿åå‡½æ•°ï¼ˆanonymous functionï¼‰çš„æ–¹å¼é€šè¿‡å‚æ•°ä¼ é€’ã€‚

* LUAå˜é‡

    * Lua ä¸­çš„å˜é‡å…¨æ˜¯å…¨å±€å˜é‡ï¼Œå“ªæ€•æ˜¯è¯­å¥å—æˆ–æ˜¯å‡½æ•°é‡Œï¼Œé™¤éç”¨ local æ˜¾å¼å£°æ˜ä¸ºå±€éƒ¨å˜é‡ã€‚
    
    * Lua å¯ä»¥å¯¹å¤šä¸ªå˜é‡åŒæ—¶èµ‹å€¼ï¼Œå˜é‡åˆ—è¡¨å’Œå€¼åˆ—è¡¨çš„å„ä¸ªå…ƒç´ ç”¨é€—å·åˆ†å¼€ï¼Œèµ‹å€¼è¯­å¥å³è¾¹çš„å€¼ä¼šä¾æ¬¡èµ‹ç»™å·¦è¾¹çš„å˜é‡ã€‚é‡åˆ°èµ‹å€¼è¯­å¥Luaä¼šå…ˆè®¡ç®—å³è¾¹æ‰€æœ‰çš„å€¼ç„¶åå†æ‰§è¡Œèµ‹å€¼æ“ä½œã€‚
    
    * å½“å˜é‡ä¸ªæ•°å’Œå€¼çš„ä¸ªæ•°ä¸ä¸€è‡´æ—¶ï¼ŒLuaä¼šä¸€ç›´ä»¥å˜é‡ä¸ªæ•°ä¸ºåŸºç¡€é‡‡å–ä»¥ä¸‹ç­–ç•¥ï¼šå˜é‡ä¸ªæ•° > å€¼çš„ä¸ªæ•°å°±æŒ‰å˜é‡ä¸ªæ•°è¡¥è¶³nilï¼›å˜é‡ä¸ªæ•° < å€¼çš„ä¸ªæ•°é‚£ä¹ˆå¤šä½™çš„å€¼ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœè¦å¯¹å¤šä¸ªå˜é‡èµ‹å€¼å¿…é¡»ä¾æ¬¡å¯¹æ¯ä¸ªå˜é‡èµ‹å€¼ã€‚

    * å¤šå€¼èµ‹å€¼ç»å¸¸ç”¨æ¥äº¤æ¢å˜é‡ï¼Œæˆ–å°†å‡½æ•°è°ƒç”¨è¿”å›ç»™å˜é‡ï¼š

        * a, b = f()-->f()è¿”å›ä¸¤ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªèµ‹ç»™aï¼Œç¬¬äºŒä¸ªèµ‹ç»™bã€‚

    * ç´¢å¼•

        * å¯¹ table çš„ç´¢å¼•ä½¿ç”¨æ–¹æ‹¬å· `[]`ï¼Œæˆ–è€…`.`

* LUAå‡½æ•°

```bash
    optional_function_scope function function_name( argument1, argument2, argument3..., argumentn)
Â Â Â Â function_body
Â Â Â Â return result_params_comma_separated
end

## optional_function_scope: è¯¥å‚æ•°æ˜¯å¯é€‰çš„æŒ‡å®šå‡½æ•°æ˜¯å…¨å±€å‡½æ•°è¿˜æ˜¯å±€éƒ¨å‡½æ•°ï¼Œæœªè®¾ç½®è¯¥å‚æ•°é»˜è®¤ä¸ºå…¨å±€å‡½æ•°ï¼Œå¦‚æœä½ éœ€è¦è®¾ç½®å‡½æ•°ä¸ºå±€éƒ¨å‡½æ•°éœ€è¦ä½¿ç”¨å…³é”®å­— localã€‚

##function_name: æŒ‡å®šå‡½æ•°åç§°ã€‚

##argument1, argument2, argument3..., argumentn: å‡½æ•°å‚æ•°ï¼Œå¤šä¸ªå‚æ•°ä»¥é€—å·éš”å¼€ï¼Œå‡½æ•°ä¹Ÿå¯ä»¥ä¸å¸¦å‚æ•°ã€‚

##function_body: å‡½æ•°ä½“ï¼Œå‡½æ•°ä¸­éœ€è¦æ‰§è¡Œçš„ä»£ç è¯­å¥å—ã€‚

##result_params_comma_separated: å‡½æ•°è¿”å›å€¼ï¼ŒLuaè¯­è¨€å‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼Œæ¯ä¸ªå€¼ä»¥é€—å·éš”å¼€ã€‚
```

>å®é™…åº”ç”¨æ—¶ä¹Ÿå¯ä»¥å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°

>Lua å‡½æ•°å¯ä»¥æ¥å—å¯å˜æ•°ç›®çš„å‚æ•°ï¼Œå’Œ C è¯­è¨€ç±»ä¼¼ï¼Œåœ¨å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­ä½¿ç”¨ä¸‰ç‚¹ ... è¡¨ç¤ºå‡½æ•°æœ‰å¯å˜çš„å‚æ•°ã€‚select('#', â€¦) è¿”å›å¯å˜å‚æ•°çš„é•¿åº¦ã€‚select(n, â€¦) ç”¨äºè¿”å›ä»èµ·ç‚¹ n å¼€å§‹åˆ°ç»“æŸä½ç½®çš„æ‰€æœ‰å‚æ•°åˆ—è¡¨ã€‚

* LUAç®—æœ¯è¿ç®—ç¬¦tips

    * `//`->æ•´é™¤è¿ç®—ç¬¦ï¼Œå¦‚ï¼š5//2=2

        * lua ä¸­ï¼Œ/ ç”¨ä½œé™¤æ³•è¿ç®—ï¼Œè®¡ç®—ç»“æœåŒ…å«å°æ•°éƒ¨åˆ†ï¼Œ// ç”¨ä½œæ•´é™¤è¿ç®—ï¼Œè®¡ç®—ç»“æœä¸åŒ…å«å°æ•°éƒ¨åˆ†ã€‚
    
    * å…³ç³»è¿ç®—ç¬¦ä¸é€»è¾‘è¿ç®—ç¬¦å’Œpythonå‡ ä¹ç›¸åŒ

    * å…¶ä»–è¿ç®—ç¬¦

    |æ“ä½œç¬¦|æè¿°|å®ä¾‹|
    |--|--|--|
    |..	|è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²|a..b ï¼Œå…¶ä¸­ a ä¸º "Hello " ï¼Œ b ä¸º "World", è¾“å‡ºç»“æœä¸º "Hello World"ã€‚|
    |#|ä¸€å…ƒè¿ç®—ç¬¦ï¼Œè¿”å›å­—ç¬¦ä¸²æˆ–è¡¨çš„é•¿åº¦ã€‚|#"zytzyt" è¿”å› 6|

    * ç®—ç¬¦ä¼˜å…ˆçº§(ä»é«˜åˆ°ä½)
    > ^
    >not    - (unary)
    >`* `  /   %
    >`+`  -
    >..
    ><      >      <=     >=     ~=     ==
    >and
    >or

* tableæ“ä½œ

|å‘½ä»¤|ç”¨é€”|
|--|--|
|table.concat (table [, sep [, start [, end]]]):|concatæ˜¯concatenate(è¿é”, è¿æ¥)çš„ç¼©å†™. table.concat()å‡½æ•°åˆ—å‡ºå‚æ•°ä¸­æŒ‡å®štableçš„æ•°ç»„éƒ¨åˆ†ä»startä½ç½®åˆ°endä½ç½®çš„æ‰€æœ‰å…ƒç´ , å…ƒç´ é—´ä»¥æŒ‡å®šçš„åˆ†éš”ç¬¦(sep)éš”å¼€ã€‚|
|table.insert (table, [pos,] value):|åœ¨tableçš„æ•°ç»„éƒ¨åˆ†æŒ‡å®šä½ç½®(pos)æ’å…¥å€¼ä¸ºvalueçš„ä¸€ä¸ªå…ƒç´ . poså‚æ•°å¯é€‰, é»˜è®¤ä¸ºæ•°ç»„éƒ¨åˆ†æœ«å°¾.|
|table.remove (table [, pos])|è¿”å›tableæ•°ç»„éƒ¨åˆ†ä½äºposä½ç½®çš„å…ƒç´ . å…¶åçš„å…ƒç´ ä¼šè¢«å‰ç§». poså‚æ•°å¯é€‰, é»˜è®¤ä¸ºtableé•¿åº¦, å³ä»æœ€åä¸€ä¸ªå…ƒç´ åˆ èµ·ã€‚|
|table.sort (table [, comp])|å¯¹ç»™å®šçš„tableè¿›è¡Œå‡åºæ’åºã€‚|

* LUAæ¨¡å—

    * Lua çš„æ¨¡å—æ˜¯ç”±å˜é‡ã€å‡½æ•°ç­‰å·²çŸ¥å…ƒç´ ç»„æˆçš„ tableï¼Œå› æ­¤åˆ›å»ºä¸€ä¸ªæ¨¡å—å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª tableï¼Œç„¶åæŠŠéœ€è¦å¯¼å‡ºçš„å¸¸é‡ã€å‡½æ•°æ”¾å…¥å…¶ä¸­ï¼Œæœ€åè¿”å›è¿™ä¸ª table å°±è¡Œã€‚æ¨¡å—çš„ç»“æ„å°±æ˜¯ä¸€ä¸ª table çš„ç»“æ„ï¼Œå› æ­¤å¯ä»¥åƒæ“ä½œè°ƒç”¨ table é‡Œçš„å…ƒç´ é‚£æ ·æ¥æ“ä½œè°ƒç”¨æ¨¡å—é‡Œçš„å¸¸é‡æˆ–å‡½æ•°ã€‚

    * Luaæä¾›äº†ä¸€ä¸ªåä¸ºrequireçš„å‡½æ•°ç”¨æ¥åŠ è½½æ¨¡å—ã€‚è¦åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼Œåªéœ€è¦ç®€å•åœ°è°ƒç”¨å°±å¯ä»¥äº†ã€‚å¦‚`require("<æ¨¡å—å>")`æˆ–`require"<æ¨¡å—å>"`

* LUAå…ƒè¡¨

    *  Lua æä¾›äº†å…ƒè¡¨`(Metatable)`ï¼Œå…è®¸æˆ‘ä»¬æ”¹å˜ table çš„è¡Œä¸ºï¼Œæ¯ä¸ªè¡Œä¸ºå…³è”äº†å¯¹åº”çš„å…ƒæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å…ƒè¡¨æˆ‘ä»¬å¯ä»¥å®šä¹‰ Lua å¦‚ä½•è®¡ç®—ä¸¤ä¸ª table çš„ç›¸åŠ æ“ä½œã€‚å½“ Lua è¯•å›¾å¯¹ä¸¤ä¸ªè¡¨è¿›è¡Œç›¸åŠ æ—¶ï¼Œå…ˆæ£€æŸ¥ä¸¤è€…ä¹‹ä¸€æ˜¯å¦æœ‰å…ƒè¡¨ï¼Œä¹‹åæ£€æŸ¥æ˜¯å¦æœ‰ä¸€ä¸ªå« `__add` çš„å­—æ®µï¼Œè‹¥æ‰¾åˆ°ï¼Œåˆ™è°ƒç”¨å¯¹åº”çš„å€¼ã€‚ `__add` ç­‰å³æ—¶å­—æ®µï¼Œå…¶å¯¹åº”çš„å€¼ï¼ˆå¾€å¾€æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–æ˜¯ tableï¼‰å°±æ˜¯"å…ƒæ–¹æ³•"ã€‚

    >`setmetatable(table,metatable)`: å¯¹æŒ‡å®š table è®¾ç½®å…ƒè¡¨`(metatable)`ï¼Œå¦‚æœå…ƒè¡¨`(metatable)`ä¸­å­˜åœ¨`__metatable` é”®å€¼ï¼Œ`setmetatable` ä¼šå¤±è´¥ã€‚

    >`getmetatable(table)`: è¿”å›å¯¹è±¡çš„å…ƒè¡¨`(metatable)`ã€‚

    * __index å…ƒæ–¹æ³•

        * è¿™æ˜¯ `metatable` æœ€å¸¸ç”¨çš„é”®ã€‚å½“é€šè¿‡é”®æ¥è®¿é—® table çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªé”®æ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆLuaå°±ä¼šå¯»æ‰¾è¯¥tableçš„`metatable`ï¼ˆå‡å®šæœ‰metatableï¼‰ä¸­çš„`__index` é”®ã€‚å¦‚æœ`__index`åŒ…å«ä¸€ä¸ªè¡¨æ ¼ï¼ŒLuaä¼šåœ¨è¡¨æ ¼ä¸­æŸ¥æ‰¾ç›¸åº”çš„é”®ã€‚
        * å¦‚æœ`__index`åŒ…å«ä¸€ä¸ªå‡½æ•°çš„è¯ï¼ŒLuaå°±ä¼šè°ƒç”¨é‚£ä¸ªå‡½æ•°ï¼Œtableå’Œé”®ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚`__index` å…ƒæ–¹æ³•æŸ¥çœ‹è¡¨ä¸­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›ç»“æœä¸º nilï¼›å¦‚æœå­˜åœ¨åˆ™ç”± `__index` è¿”å›ç»“æœã€‚

        * Lua æŸ¥æ‰¾ä¸€ä¸ªè¡¨å…ƒç´ æ—¶çš„è§„åˆ™ï¼Œå…¶å®å°±æ˜¯å¦‚ä¸‹ 3 ä¸ªæ­¥éª¤:
            * 1.åœ¨è¡¨ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œè¿”å›è¯¥å…ƒç´ ï¼Œæ‰¾ä¸åˆ°åˆ™ç»§ç»­
            * 2.åˆ¤æ–­è¯¥è¡¨æ˜¯å¦æœ‰å…ƒè¡¨ï¼Œå¦‚æœæ²¡æœ‰å…ƒè¡¨ï¼Œè¿”å› nilï¼Œæœ‰å…ƒè¡¨åˆ™ç»§ç»­ã€‚
            * 3.åˆ¤æ–­å…ƒè¡¨æœ‰æ²¡æœ‰` __index` æ–¹æ³•ï¼Œå¦‚æœ `__index` æ–¹æ³•ä¸º nilï¼Œåˆ™è¿”å› nilï¼›å¦‚æœ `__index` æ–¹æ³•æ˜¯ä¸€ä¸ªè¡¨ï¼Œåˆ™é‡å¤ 1ã€2ã€3ï¼›å¦‚æœ` __index` æ–¹æ³•æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™è¿”å›è¯¥å‡½æ•°çš„è¿”å›å€¼ã€‚


    * __newindex å…ƒæ–¹æ³•

        * __newindex å…ƒæ–¹æ³•ç”¨æ¥å¯¹è¡¨æ›´æ–°ï¼Œ__indexåˆ™ç”¨æ¥å¯¹è¡¨è®¿é—®ã€‚å½“ä½ ç»™è¡¨çš„ä¸€ä¸ªç¼ºå°‘çš„ç´¢å¼•èµ‹å€¼ï¼Œè§£é‡Šå™¨å°±ä¼šæŸ¥æ‰¾__newindex å…ƒæ–¹æ³•ï¼šå¦‚æœå­˜åœ¨åˆ™è°ƒç”¨è¿™ä¸ªå‡½æ•°è€Œä¸è¿›è¡Œèµ‹å€¼æ“ä½œã€‚

    * __call å…ƒæ–¹æ³•

        * __call å…ƒæ–¹æ³•åœ¨ Lua è°ƒç”¨ä¸€ä¸ªå€¼æ—¶è°ƒç”¨ã€‚

    * __tostring å…ƒæ–¹æ³•

        * __tostring å…ƒæ–¹æ³•ç”¨äºä¿®æ”¹è¡¨çš„è¾“å‡ºè¡Œä¸ºã€‚
        ```bash
        mytable = setmetatable({ 10, 20, 30 }, {
            __tostring = function(mytable)
                sum = 0
                for k, v in pairs(mytable) do
                        sum = sum + v
                    end
                return "è¡¨æ‰€æœ‰å…ƒç´ çš„å’Œä¸º " .. sum
            end
        })
        print(mytable)
        ```

* Lua æ–‡ä»¶ I/O

    * Lua I/O åº“ç”¨äºè¯»å–å’Œå¤„ç†æ–‡ä»¶ã€‚åˆ†ä¸ºç®€å•æ¨¡å¼ã€å®Œå…¨æ¨¡å¼ã€‚

        * ç®€å•æ¨¡å¼ï¼ˆsimple modelï¼‰æ‹¥æœ‰ä¸€ä¸ªå½“å‰è¾“å…¥æ–‡ä»¶å’Œä¸€ä¸ªå½“å‰è¾“å‡ºæ–‡ä»¶ï¼Œå¹¶ä¸”æä¾›é’ˆå¯¹è¿™äº›æ–‡ä»¶ç›¸å…³çš„æ“ä½œã€‚

            *  `io.tmpfile()`:è¿”å›ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¥æŸ„ï¼Œè¯¥æ–‡ä»¶ä»¥æ›´æ–°æ¨¡å¼æ‰“å¼€ï¼Œç¨‹åºç»“æŸæ—¶è‡ªåŠ¨åˆ é™¤

            * `io.type(file)`: æ£€æµ‹objæ˜¯å¦ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶å¥æŸ„

            * `io.flush()`: å‘æ–‡ä»¶å†™å…¥ç¼“å†²ä¸­çš„æ‰€æœ‰æ•°æ®

            * `io.lines(optional file name)`: è¿”å›ä¸€ä¸ªè¿­ä»£å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨å°†è·å¾—æ–‡ä»¶ä¸­çš„ä¸€è¡Œå†…å®¹ï¼Œå½“åˆ°æ–‡ä»¶å°¾æ—¶ï¼Œå°†è¿”å› nilï¼Œä½†ä¸å…³é—­æ–‡ä»¶ã€‚

        * å®Œå…¨æ¨¡å¼ï¼ˆcomplete modelï¼‰ ä½¿ç”¨å¤–éƒ¨çš„æ–‡ä»¶å¥æŸ„æ¥å®ç°ã€‚å®ƒä»¥ä¸€ç§é¢å¯¹å¯¹è±¡çš„å½¢å¼ï¼Œå°†æ‰€æœ‰çš„æ–‡ä»¶æ“ä½œå®šä¹‰ä¸ºæ–‡ä»¶å¥æŸ„çš„æ–¹æ³•

            * `file:seek(optional whence, optional offset)`: è®¾ç½®å’Œè·å–å½“å‰æ–‡ä»¶ä½ç½®,æˆåŠŸåˆ™è¿”å›æœ€ç»ˆçš„æ–‡ä»¶ä½ç½®(æŒ‰å­—èŠ‚),å¤±è´¥åˆ™è¿”å›nilåŠ é”™è¯¯ä¿¡æ¯ã€‚å‚æ•° whence å€¼å¯ä»¥æ˜¯:

                * `"set"`: ä»æ–‡ä»¶å¤´å¼€å§‹
                * `"cur"`: ä»å½“å‰ä½ç½®å¼€å§‹[é»˜è®¤]
                * `"end"`: ä»æ–‡ä»¶å°¾å¼€å§‹
                * `offset`:é»˜è®¤ä¸º0
             ä¸å¸¦å‚æ•°`file:seek()`åˆ™è¿”å›å½“å‰ä½ç½®,`file:seek("set")`åˆ™å®šä½åˆ°æ–‡ä»¶å¤´,`file:seek("end")`åˆ™å®šä½åˆ°æ–‡ä»¶å°¾å¹¶è¿”å›æ–‡ä»¶å¤§å°

            * f`ile:flush()`: å‘æ–‡ä»¶å†™å…¥ç¼“å†²ä¸­çš„æ‰€æœ‰æ•°æ®

            * `io.lines(optional file name)`: æ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶ `filename` ä¸ºè¯»æ¨¡å¼å¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨å°†è·å¾—æ–‡ä»¶ä¸­çš„ä¸€è¡Œå†…å®¹ï¼Œå½“åˆ°æ–‡ä»¶å°¾æ—¶ï¼Œå°†è¿”å› nilï¼Œå¹¶è‡ªåŠ¨å…³é—­æ–‡ä»¶ã€‚
è‹¥ä¸å¸¦å‚æ•°æ—¶`io.lines() <=> io.input():lines()`; è¯»å–é»˜è®¤è¾“å…¥è®¾å¤‡çš„å†…å®¹ï¼Œä½†ç»“æŸæ—¶ä¸å…³é—­æ–‡ä»¶

* LUAåƒåœ¾å›æ”¶

    * Lua æä¾›äº†ä»¥ä¸‹å‡½æ•°collectgarbage ([opt [, arg]])ç”¨æ¥æ§åˆ¶è‡ªåŠ¨å†…å­˜ç®¡ç†:

        * `collectgarbage("collect")`: åšä¸€æ¬¡å®Œæ•´çš„åƒåœ¾æ”¶é›†å¾ªç¯ã€‚é€šè¿‡å‚æ•° opt å®ƒæä¾›äº†ä¸€ç»„ä¸åŒçš„åŠŸèƒ½ï¼š

        * `collectgarbage("count")`: ä»¥ K å­—èŠ‚æ•°ä¸ºå•ä½è¿”å› Lua ä½¿ç”¨çš„æ€»å†…å­˜æ•°ã€‚ è¿™ä¸ªå€¼æœ‰å°æ•°éƒ¨åˆ†ï¼Œæ‰€ä»¥åªéœ€è¦ä¹˜ä¸Š 1024 å°±èƒ½å¾—åˆ° Lua ä½¿ç”¨çš„å‡†ç¡®å­—èŠ‚æ•°ï¼ˆé™¤éæº¢å‡ºï¼‰ã€‚

        * `collectgarbage("restart")`: é‡å¯åƒåœ¾æ”¶é›†å™¨çš„è‡ªåŠ¨è¿è¡Œã€‚

        * `collectgarbage("setpause")`: å°† arg è®¾ä¸ºæ”¶é›†å™¨çš„ é—´æ­‡ç‡ã€‚ è¿”å› é—´æ­‡ç‡ çš„å‰ä¸€ä¸ªå€¼ã€‚

        * `collectgarbage("setstepmul")`: è¿”å› æ­¥è¿›å€ç‡ çš„å‰ä¸€ä¸ªå€¼ã€‚

        * `collectgarbage("step")`: å•æ­¥è¿è¡Œåƒåœ¾æ”¶é›†å™¨ã€‚ æ­¥é•¿"å¤§å°"ç”± arg æ§åˆ¶ã€‚ ä¼ å…¥ 0 æ—¶ï¼Œæ”¶é›†å™¨æ­¥è¿›ï¼ˆä¸å¯åˆ†å‰²çš„ï¼‰ä¸€æ­¥ã€‚ ä¼ å…¥é 0 å€¼ï¼Œ æ”¶é›†å™¨æ”¶é›†ç›¸å½“äº Lua åˆ†é…è¿™äº›å¤šï¼ˆK å­—èŠ‚ï¼‰å†…å­˜çš„å·¥ä½œã€‚ å¦‚æœæ”¶é›†å™¨ç»“æŸä¸€ä¸ªå¾ªç¯å°†è¿”å› true ã€‚

        * `collectgarbage("stop")`: åœæ­¢åƒåœ¾æ”¶é›†å™¨çš„è¿è¡Œã€‚ åœ¨è°ƒç”¨é‡å¯å‰ï¼Œæ”¶é›†å™¨åªä¼šå› æ˜¾å¼çš„è°ƒç”¨è¿è¡Œã€‚

#### ç½‘ç»œé…ç½®

å®Œæˆä»¥ä¸‹é…ç½®ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥ip:`192.168.23.15`ç™»å½•å›ºä»¶åŠä¸‹è½½ç›¸å…³è½¯ä»¶åŒ…

* `vim /etc/config/network`

    * ä¿®æ”¹ipaddrä»¥`192.168.23.15`

* `vim /etc/resolv.conf`

    * ä¿®æ”¹`nameserver`ä¸º`8.8.8.8`

#### ftpè¿œç¨‹è¿æ¥

ftpè¿œç¨‹è¿æ¥è™šæ‹Ÿæœºæ–¹ä¾¿ä¿®æ”¹ç›¸å…³æ–‡ä»¶

* åœ¨è™šæ‹Ÿæœºä¸­
`opkg update`
`opkg install vsftpd`

* ä¸»æœºåœ¨vscodeå†…æœç´¢æ‰©å±•`ftp-simple`ï¼Œä¸‹è½½å¹¶å®‰è£…

* `shift+ctrl+p`æœç´¢`config-ftp connection setting`è¿›è¡Œé…ç½®ï¼Œç¼–è¾‘ï¼š
```bash
[
	{
		"name": "dvrf",
		"host": "192.168.23.128",
		"port": 21,
		"type": "ftp",
		"username": "root",
		"password": "zytzyt",
		"path": "/",
		"autosave": true,
		"confirm": true
	}
]
```

* `shift+ctrl+p`æœç´¢`remote directory open to workspace`ï¼Œç„¶ååœ¨å…¶ä¸­é€‰æ‹©æ–‡ä»¶å¤¹ä¼ è¾“å³å¯ã€‚

#### ä¿®æ”¹banner

`etc/banner`
ä¿®æ”¹ä¸ªæ€§åŒ–banner
```bash
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•  
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     
â•šâ•â•â•â•â•â•   â•šâ•â•â•â•  â•šâ•â•  â•šâ•â•â•šâ•â•     
    Damn Vulnerable Router Firmware 
-----------------------------------------------------
Based on Openwrt
Developed by students from Communication University of China
-----------------------------------------------------
```

#### æ·»åŠ å­é¡µæˆ–å¯¼èˆªæ 

**æ·»åŠ å­é¡µ**

* `vim /usr/lib/lua/luci/controller/admin/system.lua`

```bash
entry({"admin","system","zytzytzyt"},template("admin_system/zytzytzyt),_("zytzytzyt") , 99)
```

* `vim /usr/lib/lua/luci/view/admin_system/zytzytzyt.htm`

```bash
<%+header%>
<h1><%: ZYTZYTZYT%></h1>
<%+footer%>
```

åç»­å¯ä»¥æ„é€ ç½‘é¡µï¼Œéšè—ä¿¡æ¯ã€æç¤ºä¿¡æ¯ç­‰ç­‰

**æ·»åŠ å¯¼èˆªæ æ ‡ç­¾**

å¦‚ï¼š

* `vim package/feeds/luci/luci-mod-admin-full/luasrc/controller/admin/new_tab.lua`

```bash
module("luci.controller.admin.new_tab", package.seeall)
Â 
function index()
        entry({"admin", "new_tab"}, firstchild(), "New tab", 60).dependent=false
        -- entry({"admin", "new_tab", "tab_from_cbi"}, cbi("myapp-mymodule/cbi_tab"), "CBI Tab", 1)
        entry({"admin", "new_tab", "tab_from_view"}, template("admin_myapp/view_tab"), "View Tab", 2)
end
```

* `mkdir package/feeds/luci/luci-mod-admin-full/luasrc/view/admin_myapp`

* `vim package/feeds/luci/luci-mod-admin-full/luasrc/view/admin_myapp/view_tab.htm`

```bash
<%+header%>
<h1><%: ZYTZYTZYT%></h1>
<%+footer%>
```

**æœ‰ç¼“å­˜ï¼Œæ¸…é™¤ç¼“å­˜å’Œé‡å¯æœåŠ¡å™¨**

`/etc/init.d/uhttpd restart`

`rm â€“fr /tmp/luci-*`

#### MVC

* **view** â€“ æ¨¡æ¿ç³»ç»ŸTemplateï¼Œæ§åˆ¶å‰ç«¯æ˜¾ç¤ºæ•ˆæœ,ç±»ä¼¼ Cè¯­è¨€å¼€å‘ CGI çš„ flate åº“ï¼Œjava çš„ jsp æŠ€æœ¯
    
    * openwrt ç³»ç»Ÿè·¯å¾„ /usr/lib/lua/luci/view/

    * å†…å®¹æ›¿æ¢æ ¼å¼
        ```bash
        <%+[include]%>ï¼šå¼•ç”¨æ¨¡æ¿ (ex: <%+header%>; <%+footer%>)
        <%:[string]%>ï¼šè¾“å‡ºå†…å®¹ (ex: <%:Hello World%>)
        <%=[code]%>ï¼šæ‰§è¡Œ lua ä»£ç 
        ç­‰ç­‰...
        ```

* **controller** â€“ æ§åˆ¶å™¨ï¼Œè·¯ç”±é€»è¾‘å’ŒåŠŸèƒ½ï¼ˆfunctionï¼‰å…¥å£ï¼Œä½¿ç”¨luaè¯­è¨€

    * index ä¸­é€šè¿‡ entry å£°æ˜äº† url å’Œè¯¥ url å¯¹åº”çš„è¡Œä¸ºï¼ˆfunctionï¼‰

    * ä¸»è¦ä¸º call, template, cbi ä¸‰ç§è¡Œä¸º

        * call â€“ ç›´æ¥æ‰§è¡Œå®šä¹‰çš„å‡½æ•°
        * template â€“ æ¸²æŸ“æŒ‡å®š *.htm æ¨¡æ¿ä½œä¸ºå“åº”è¿”å›
        * cbi â€“ æ‰§è¡Œä»¥ CBI æ¡†æ¶ç¼–å†™çš„æ¨¡å—

* **model** â€“ é…ç½®ç®¡ç†ï¼Œ(æ•°æ®)æ¨¡å‹ç³»ç»Ÿ/èµ„æºé…ç½®

    * æ¨¡å‹å°±æ˜¯ CBI -- æ“ä½œ UCI
        
        * CBI(Configuration Binding Interface) ->UCI(Unified Configuration Interface)

    * CBI ä¹Ÿç®—æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨æˆ·ï¼ˆç¨‹åºå‘˜ï¼‰ç¼–å†™çš„æ˜¯â€œæ¨¡å—â€



#### é—®é¢˜

* `opkg update&&opkg install vsftpd`é‡åˆ°

```bash
Collected errors:
 * opkg_download: Failed to download http://downloads.openwrt.org/releases/18.06.2/packages/i386_pentium4/packages/Packages.gz, wget returned 4.
 * opkg_download: Check your network settings and connectivity.

 * opkg_download: Failed to download http://downloads.openwrt.org/releases/18.06.2/packages/i386_pentium4/telephony/Packages.sig, wget returned 4.
 * opkg_download: Check your network settings and connectivity.
```

ç½‘ç»œæ˜¯è”é€šçš„ï¼Œæ ¹æ®ç½‘å‹æç¤ºä½¿ç”¨`wget`å‘½ä»¤å°†åŒ…é‡æ–°ä¸‹è½½ï¼Œä½†æ˜¯æœªæœã€‚éšåå°è¯•æ›´æ¢openwrt çš„opkg releaseé•œåƒæºï¼ŒæˆåŠŸä¸‹è½½ã€‚
```bash
##æ‰‹å·¥æ›¿æ¢
ç™»å½•åˆ°è·¯ç”±å™¨ï¼Œå¹¶ç¼–è¾‘ /etc/opkg/distfeeds.conf æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„ downloads.openwrt.org æ›¿æ¢ä¸º mirrors.tuna.tsinghua.edu.cn/openwrt å³å¯ã€‚

##è‡ªåŠ¨æ›¿æ¢
æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è‡ªåŠ¨æ›¿æ¢

sed -i 's_downloads.openwrt.org_mirrors.tuna.tsinghua.edu.cn/openwrt_' /etc/opkg/distfeeds.conf
```

### å­¦ä¹ è®°å½•æ›´æ–°åœ°å€

å­¦ä¹ commitè®°å½•åœ¨ä»“åº“ï¼š[zhouyutingï¼ˆå·²å¤±æ•ˆï¼‰](https://github.com/zhouyuting-mafumafu/DVRF/blob/main/%E7%8C%AA%E8%B9%84learningrecord.md)

[zhouyuting](https://github.com/zhouyuting-mafumafu/DVRF/tree/record/learning%20record)

â—â—â—ç”±äºæœ¬äººæ“ä½œå¤±è¯¯ï¼Œå­¦ä¹ è®°å½•æœ€åˆè®°å½•åœ¨äº†ä¸Šæ¸¸ä»“åº“æ‰€forkçš„æœ¬äººçš„ä¸»åˆ†æ”¯é‡Œï¼Œä½†æ˜¯ç”±äºæœ€åä¸»ä»“åº“æ›´æ–°äº†ï¼Œæ²¡æœ‰çœ‹æ¸…æ¥šå°±ç›´æ¥Sync forkäº†ä¹‹åï¼Œå¯¼è‡´åŸæ¥æ›´æ–°çš„è®°å½•éƒ½æ‰¾ä¸å›æ¥äº†ï¼Œå› ä¸ºæœ€åˆæ²¡æœ‰å…‹éš†åˆ°æœ¬åœ°ï¼Œå°±æ— æ³•ä»æœ¬åœ°çš„.gitæ–‡ä»¶è®°å½•é‡Œæ‰¾å›ã€‚ğŸ˜«ğŸ˜«ğŸ˜­
ä½†æ˜¯å¯ä»¥ä»ä»¥ä¸‹å‡ å¼ å›¾ç‰‡çœ‹å‡ºæ¥ç¡®å®æ˜¯æ›¾ç»å­˜åœ¨è¿‡çš„ï¼Œä¹Ÿå¤šæ¬¡commitè‡³ç”±äºæœ¬äººå†™æŠ¥å‘Šæœ‰æ¯æ¬¡å†™å®Œä¿å­˜åˆ°æœ¬åœ°è¿˜ä¸å¤Ÿï¼Œå–œæ¬¢å‘é€åˆ°å¾®ä¿¡æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹æ¥ç¡®ä¿æ–‡ä»¶â€œä¸‡æ— ä¸€å¤±â€ï¼Œå‘å¾®è¯æ˜ä¸€ä¸‹ï¼š

![](img/1.png)

![](img/2.png)

![](img/3.png)

![](img/4.png)

![](img/5.png)

![](img/6.png)

### å‚è€ƒæ–‡çŒ®
[æ¸…åå¤§å­¦opkg releaseé•œåƒæº](https://mirror.tuna.tsinghua.edu.cn/help/openwrt/)

[opkg updateæŠ¥é”™è§£å†³æ–¹æ³•](https://blog.csdn.net/weixin_39510813/article/details/78564307)

[CVE-2019-17367](https://www.cvedetails.com/cve/CVE-2019-17367/)

[CVE-2019-18993](https://www.cvedetails.com/cve/CVE-2019-18993/)

[CVE-2019-18992](https://www.cvedetails.com/cve/CVE-2019-18992/)

[XSS](https://cloud.tencent.com/developer/article/1573003)

[XSS è¿‡æ»¤ç»•è¿‡å¤‡å¿˜å•](https://wizardforcel.gitbooks.io/owasp-cheat-sheet-zh/content/xss-filter-evasion-cheat-sheet.html)

[XSS ctf é¢˜ç›®](https://juejin.cn/s/ctf%20xss%20%E9%A2%98%E7%9B%AE)

[burpsuite](https://blog.csdn.net/guo15890025019/article/details/106297296)
